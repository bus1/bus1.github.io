<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>org.bus1.bootstrap</title><link rel="stylesheet" type="text/css" href="bus1.css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></meta><link xmlns="" rel="icon" href="bus1.png" type="image/png"><script xmlns="">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-75729104-1', 'auto');
      ga('send', 'pageview');
    </script></head><body><header xmlns=""><a href="/"><img src="bus1.svg" alt="bus1" style="width:48px;height:48px;"></a><span class="version">Version 1</span></header><div class="refentry"><a id="org.bus1.bootstrap"></a><div class="titlepage"></div><div class="refnamediv"><p>org.bus1.bootstrap — Bootstrap</p></div><div class="refsect1"><a id="id-1.4"></a><h2>The bootstrap process of the bus1 system.</h2><p>The system consists of an init process, a bus activation service, and
    a central management process called the administrator. The administrator is
    the key component of the bus1 system. It reads the system configuration,
    configures the services and stays connected to them. The activator is
    responsible for starting system binaries and to connect them to the bus.
    Apart from the initial execution of the activator itself and the administrator
    all services are started by the activator.</p><p>Init opens the bus1 file descriptor and creates the initial peer
    for itself.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.init             │ ─── open("/dev/bus1") ──────┐
├────────────────────────────────────┤                             │
│ peer (org.bus1.init)               │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││ ◄── ioctl(PEER_INIT) ───────┘
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>Init creates the peer for the administrator. The administrator's
    root handle gets created and init gets a handle to it.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.init             │
├────────────────────────────────────┤
│ peer (org.bus1.init)               │ ─── ioctl(PEER_CLONE) ──────┐
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.administrator)  ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.administrator)      │ ◄───────────────────────────┘
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>Init sends its own root handle to the administrator.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.init             │
├────────────────────────────────────┤
│ peer (org.bus1.init)               │
│┌──────────────────────────────────┐│
││ handle (self)                    ││ ─── ioctl(SEND) ────────────┐
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.administrator)  ││                             │
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.administrator)      │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.init)           ││ ◄───────────────────────────┘
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>Init creates the peer for the activator. The activator's
    root handle gets created and the administrator gets a handle to
    it.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.init             │
├────────────────────────────────────┤
│ peer (org.bus1.init)               │
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
│┌──────────────────────────────────┐│
││ handle (org.bus1.administrator)  ││
│└──────────────────────────────────┘│
├────────────────────────────────────┤
│ peer (org.bus1.administrator)      │ ─── ioctl(PEER_CLONE) ──────┐
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.init)           ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.activator)      ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.activator)          │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││ ◄───────────────────────────┘
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>Init forks and executes the administrator and activator
    binaries and passes along the bus peers created for them.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.init             │ ──┬ exec() ┬────────────────┐
├────────────────────────────────────┤   │        │                │
│ peer (org.bus1.init)               │   └ exec() ┘                │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.administrator)  ││                             │
│└──────────────────────────────────┘│                             │
└────────────────────────────────────┘                             │
                                                                   │
┌────────────────────────────────────┐                             │
│ /usr/bin/org.bus1.administrator    │ ◄───────────────────────────┤
├────────────────────────────────────┤                             │
│ peer (org.bus1.administrator)      │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.init)           ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.activator)      ││                             │
│└──────────────────────────────────┘│                             │
└────────────────────────────────────┘                             │
                                                                   │
┌────────────────────────────────────┐                             │
│ /usr/bin/org.bus1.activator        │ ◄───────────────────────────┘
├────────────────────────────────────┤
│ peer (org.bus1.activator)          │
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
└────────────────────────────────────┘

</pre><p>The administrator pushes the configuration of the services it requires into
    the activator.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.administrator    │
├────────────────────────────────────┤
│ peer (org.bus1.administrator)      │
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
│┌──────────────────────────────────┐│
││ handle (org.bus1.activator)      ││ ─── ioctl(SEND) ────────────┐
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.init)           ││                             │
│└──────────────────────────────────┘│                             │
└────────────────────────────────────┘                             │
                                                                   ┴
                                  { name="org.bus1.audio", exec="/usr/bin/org.bus1.audio", uid=, ... }
                                  { name="org.bus1.network", exec="/usr/bin/org.bus1.network", uid=, ... }
                                  { name="org.bus1.timesync", exec="/usr/bin/org.bus1.timesync", uid=, ... }
                                                                   ┬
┌────────────────────────────────────┐                             │
│ /usr/bin/org.bus1.activator        │                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.activator)          │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││ ◄───────────────────────────┘
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>The activator creates a bus peer for every service. The services
    root handles get created and the activator gets handles to them.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.activator        │ ──┬ ioctl(PEER_CLONE) ┬─────┐
├────────────────────────────────────┤   │                   │     │
│ peer (org.bus1.activator)          │   ├ ioctl(PEER_CLONE) ┤     │
│┌──────────────────────────────────┐│   │                   │     │
││ handle (self)                    ││   └ ioctl(PEER_CLONE) ┘     │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.audio)          ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.network)        ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.timesync)       ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.audio)              │ ◄───────────────────────────┤
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.network)            │ ◄───────────────────────────┤
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.timesync)           │ ◄───────────────────────────┘
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre><p>The activator replies to the administrator with the created service
    handles. The activator watches all service handles. On incoming messages,
    the activator executes the service binary and passes along the bus peer
    of the service. The started service can read the message from its handle
    and reply to it.</p><pre class="screen">
┌────────────────────────────────────┐
│ /usr/bin/org.bus1.activator        │
├────────────────────────────────────┤
│ peer (org.bus1.activator)          │
│┌──────────────────────────────────┐│
││ handle (self)                    ││
│└──────────────────────────────────┘│
├────────────────────────────────────┤
│ peer (org.bus1.audio)              │
│┌──────────────────────────────────┐│
││ handle (self)                    ││ ── ioctl(SEND) ─────────────┐
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.network)            │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││ ────────────────────────────┤
│└──────────────────────────────────┘│                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.timesync)           │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││ ────────────────────────────┤
│└──────────────────────────────────┘│                             │
└────────────────────────────────────┘                             │
                                                                   │
┌────────────────────────────────────┐                             │
│ /usr/bin/org.bus1.administrator    │                             │
├────────────────────────────────────┤                             │
│ peer (org.bus1.administrator)      │                             │
│┌──────────────────────────────────┐│                             │
││ handle (self)                    ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.activator)      ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.init)           ││                             │
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.audio)          ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.network)        ││ ◄───────────────────────────┤
│└──────────────────────────────────┘│                             │
│┌──────────────────────────────────┐│                             │
││ handle (org.bus1.timesync)       ││ ◄───────────────────────────┘
│└──────────────────────────────────┘│
└────────────────────────────────────┘
</pre></div><div class="refsect1"><a id="id-1.5"></a><h2>See Also</h2><p>
        <a xmlns="" href="org.bus1.activator.html"><span xmlns="http://www.w3.org/1999/xhtml" class="citerefentry"><span class="refentrytitle">org.bus1.activator</span>(1)</span></a>,
        <a xmlns="" href="org.bus1.init.html"><span xmlns="http://www.w3.org/1999/xhtml" class="citerefentry"><span class="refentrytitle">org.bus1.init</span>(1)</span></a>,
        <a class="ulink" href="https://github.com/bus1/base">Git repository</a>
      </p></div></div></body></html>
